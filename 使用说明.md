# chfs-py 使用说明

## 🚀 快速开始

### 一键启动（推荐）

1. **下载项目到本地**
2. **双击运行 `快速启动.cmd`**
3. **等待脚本自动完成环境检查与依赖安装**
4. **浏览器自动打开，即可开始使用！**

> `快速启动.cmd` 集成了依赖安装、配置初始化与服务启动流程，是唯一需要使用的启动脚本。

### 手动部署（可选）

如需手动控制安装流程，可按照以下步骤执行：

1. **安装依赖**
   ```cmd
   双击运行 "安装依赖.bat"
   ```

2. **手动运行服务**
   ```cmd
   python -m app.main --config chfs-simple.yaml
   ```

## 📋 系统要求

- **操作系统**: Windows 10/11 或 Windows Server 2019+
- **Python**: 3.11+ （会自动检查，未安装会提示下载）
- **内存**: 最少 256MB，推荐 512MB+
- **磁盘**: 50MB+ 用于程序文件

## 🌐 访问地址

启动成功后，可通过以下地址访问：

- **Web 界面**: http://127.0.0.1:8080
- **WebDAV**: http://127.0.0.1:8080/webdav （如果启用）

## 👤 默认账户

- **管理员**: `admin` / `123456`

## 📁 目录结构

```
项目根目录/
├── data/                   # 数据目录
│   ├── public/            # 公共文件夹
│   ├── home/              # 用户文件夹
│   └── logs/              # 日志文件
├── chfs-simple.yaml       # 配置文件
├── 快速启动.cmd           # Windows 快速启动脚本
├── 安装依赖.bat           # 依赖安装脚本
└── app/                   # 程序文件
```

## ✨ 主要功能

### 📂 文件管理
- ✅ 文件上传/下载
- ✅ 文件夹创建/删除
- ✅ 文件重命名
- ✅ 批量操作
- ✅ 拖拽上传

### 🔐 权限控制
- ✅ 用户认证（HTTP Basic Auth）
- ✅ 基于规则的权限管理
- ✅ IP 地址过滤
- ✅ 操作权限控制（读/写/删除）

### 🌐 Web 界面
- ✅ 响应式设计（支持手机/平板）
- ✅ 中文界面
- ✅ 文件预览
- ✅ 快速搜索

### 📁 WebDAV 支持
- ✅ 挂载为网络驱动器
- ✅ 与 Web 界面共享权限
- ✅ 支持各种 WebDAV 客户端

### 📝 文本分享
- ✅ 快速创建文本分享
- ✅ 生成短链接
- ✅ 语法高亮显示

## 🔧 常见问题

### Q: 启动时提示"未找到 Python"？
**A**: 请下载安装 Python 3.11+：https://www.python.org/downloads/
安装时记得勾选 "Add Python to PATH"

### Q: 依赖安装失败？
**A**: 
1. 检查网络连接
2. 尝试运行 `安装依赖.bat` 脚本
3. 手动安装：`pip install fastapi uvicorn pyyaml jinja2 aiofiles`

### Q: WebDAV 功能不可用？
**A**: WebDAV 是可选功能，安装失败不影响基本文件服务器功能。如需使用：
```cmd
pip install wsgidav
```

### Q: 无法访问 Web 界面？
**A**: 
1. 检查是否有其他程序占用 8080 端口
2. 确认防火墙设置
3. 尝试使用 http://localhost:8080

### Q: 忘记管理员密码？
**A**: 删除 `chfs-simple.yaml` 文件，重新运行启动脚本会重新生成默认配置

### Q: 如何更改端口？
**A**: 编辑 `chfs-simple.yaml` 文件，修改 `server.port` 的值

## 🛠️ 高级配置

### 修改配置文件

编辑 `chfs-simple.yaml` 文件可以自定义：

```yaml
server:
  addr: "0.0.0.0"    # 监听地址
  port: 8080          # 监听端口

users:
  - name: "admin"     # 用户名
    pass: "123456"    # 密码
    pass_bcrypt: false

ui:
  language: "zh"      # 界面语言 (zh/en)
  # maxUploadSize: 104857600  # 可选，设置后限制最大上传大小
```

### 添加用户

在 `users` 部分添加新用户：

```yaml
users:
  - name: "admin"
    pass: "123456"
    pass_bcrypt: false
  - name: "user1"     # 新用户
    pass: "password"
    pass_bcrypt: false
```

在 `rules` 部分添加权限：

```yaml
rules:
  - who: "user1"
    allow: ["R"]       # R=读取, W=写入, D=删除
    roots: ["public"]  # 可访问的文件夹
    paths: ["/"]
    ip_allow: ["*"]
```

## 🔒 安全建议

1. **更改默认密码**: 修改配置文件中的默认密码
2. **限制 IP 访问**: 在 `ipFilter` 中设置允许的 IP 范围
3. **使用 HTTPS**: 在生产环境中配置 SSL 证书
4. **定期备份**: 备份 `data` 目录和配置文件

## 📞 技术支持

如遇到问题，请：

1. 查看日志文件：`data/logs/chfs.log`
2. 检查配置文件格式是否正确
3. 确认 Python 和依赖包版本
4. 查看项目 README.md 获取更多信息

## 🎉 享受使用！

chfs-py 是一个轻量、安全、易用的文件服务器。希望它能帮助您轻松管理和分享文件！
